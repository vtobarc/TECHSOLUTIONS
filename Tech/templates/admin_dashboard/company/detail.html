{% extends 'admin_dashboard/base.html' %}
{% load static %}
{% load widget_tweaks %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/admin_dashboard/css/company-form.css' %}">
{% endblock %}

{% block title %}Información de la Empresa - Panel de Administración{% endblock %}
{% block content %}
<div class="header">
    <div class="header-content">
        <h1 class="page-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="4" y="2" width="16" height="20" rx="2" ry="2"></rect><line x1="9" y1="2" x2="9" y2="22"></line><line x1="15" y1="2" x2="15" y2="22"></line><line x1="4" y1="12" x2="20" y2="12"></line></svg>
            Información de la Empresa
        </h1>
    </div>
</div>

<div class="main-content">
    <div class="grid">
        <!-- Columna Principal -->
        <div>
            <form method="POST" enctype="multipart/form-data" id="companyForm">
                {% csrf_token %}
                
                <!-- Información Básica -->
                <div class="card">
                    <div class="card-header card-header-primary">
                        <h2 class="card-title card-title-primary">Información Básica</h2>
                    </div>
                    <div class="card-body">
                        {% if form.non_field_errors %}
                        <div class="alert alert-danger">
                            {% for error in form.non_field_errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                        {% endif %}

                        <div class="form-row form-row-2">
                            <div class="form-group">
                                <label for="{{ form.name.id_for_label }}" class="form-label">Nombre de la Empresa *</label>
                                {{ form.name|add_class:"form-control" }}
                                {% if form.name.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.name.errors|join:", " }}
                                    </div>
                                {% endif %}
                            </div>

                            <div class="form-group">
                                <label for="{{ form.ruc.id_for_label }}" class="form-label">RUC *</label>
                                {{ form.ruc|add_class:"form-control" }}
                                {% if form.ruc.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.ruc.errors|join:", " }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Logo de la Empresa</label>
                            <div class="file-upload-area">
                                <div class="file-upload-content">
                                    {% if company.logo %}
                                        <img src="{{ company.logo.url }}" alt="Logo" class="mb-2" style="max-height: 150px;">
                                    {% else %}
                                        <svg class="file-upload-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
                                    {% endif %}
                                    <p class="file-upload-text">Arrastra y suelta un archivo o</p>
                                    <button type="button" class="file-upload-button">Seleccionar archivo</button>
                                </div>
                            </div>
                            {{ form.logo|add_class:"file-input" }}
                            {% if form.logo.errors %}
                                <div class="invalid-feedback">
                                    {{ form.logo.errors|join:", " }}
                                </div>
                            {% endif %}
                        </div>

                        <div class="form-group">
                            <label for="{{ form.mission.id_for_label }}" class="form-label">Misión</label>
                            {{ form.mission|add_class:"form-control" }}
                            {% if form.mission.errors %}
                                <div class="invalid-feedback">
                                    {{ form.mission.errors|join:", " }}
                                </div>
                            {% endif %}
                        </div>

                        <div class="form-group">
                            <label for="{{ form.vision.id_for_label }}" class="form-label">Visión</label>
                            {{ form.vision|add_class:"form-control" }}
                            {% if form.vision.errors %}
                                <div class="invalid-feedback">
                                    {{ form.vision.errors|join:", " }}
                                </div>
                            {% endif %}
                        </div>

                        <div class="form-group">
                            <label for="{{ form.values.id_for_label }}" class="form-label">Valores</label>
                            {{ form.values|add_class:"form-control" }}
                            {% if form.values.errors %}
                                <div class="invalid-feedback">
                                    {{ form.values.errors|join:", " }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Información de Contacto -->
                <div class="card">
                    <div class="card-header card-header-blue">
                        <h2 class="card-title card-title-blue">Información de Contacto</h2>
                    </div>
                    <div class="card-body">
                        <div class="form-row form-row-2">
                            <div class="form-group">
                                <label for="{{ form.email.id_for_label }}" class="form-label form-label-with-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                                    Email *
                                </label>
                                {{ form.email|add_class:"form-control" }}
                                {% if form.email.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.email.errors|join:", " }}
                                    </div>
                                {% endif %}
                            </div>

                            <div class="form-group">
                                <label for="{{ form.phone.id_for_label }}" class="form-label form-label-with-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                                    Teléfono *
                                </label>
                                {{ form.phone|add_class:"form-control" }}
                                {% if form.phone.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.phone.errors|join:", " }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="{{ form.address.id_for_label }}" class="form-label form-label-with-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                                Dirección
                            </label>
                            {{ form.address|add_class:"form-control" }}
                            {% if form.address.errors %}
                                <div class="invalid-feedback">
                                    {{ form.address.errors|join:", " }}
                                </div>
                            {% endif %}
                        </div>

                        <div class="form-row form-row-3">
                            <div class="form-group">
                                <label for="{{ form.city.id_for_label }}" class="form-label">Ciudad</label>
                                {{ form.city|add_class:"form-control" }}
                                {% if form.city.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.city.errors|join:", " }}
                                    </div>
                                {% endif %}
                            </div>

                            <div class="form-group">
                                <label for="{{ form.province.id_for_label }}" class="form-label">Provincia</label>
                                {{ form.province|add_class:"form-control" }}
                                {% if form.province.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.province.errors|join:", " }}
                                    </div>
                                {% endif %}
                            </div>

                            <div class="form-group">
                                <label for="{{ form.country.id_for_label }}" class="form-label">País</label>
                                {{ form.country|add_class:"form-control" }}
                                {% if form.country.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.country.errors|join:", " }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Redes Sociales -->
                <div class="card">
                    <div class="card-header card-header-purple">
                        <h2 class="card-title card-title-purple">Redes Sociales</h2>
                    </div>
                    <div class="card-body">
                        <div class="form-row form-row-2">
                            <div class="form-group">
                                <label for="{{ form.facebook.id_for_label }}" class="form-label form-label-with-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-600"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg>
                                    Facebook
                                </label>
                                {{ form.facebook|add_class:"form-control" }}
                            </div>

                            <div class="form-group">
                                <label for="{{ form.twitter.id_for_label }}" class="form-label form-label-with-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-400"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg>
                                    Twitter
                                </label>
                                {{ form.twitter|add_class:"form-control" }}
                            </div>

                            <div class="form-group">
                                <label for="{{ form.instagram.id_for_label }}" class="form-label form-label-with-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-pink-600"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></svg>
                                    Instagram
                                </label>
                                {{ form.instagram|add_class:"form-control" }}
                            </div>

                            <div class="form-group">
                                <label for="{{ form.linkedin.id_for_label }}" class="form-label form-label-with-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-700"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg>
                                    LinkedIn
                                </label>
                                {{ form.linkedin|add_class:"form-control" }}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Información Adicional -->
                <div class="card">
                    <div class="card-header card-header-green">
                        <h2 class="card-title card-title-green">Información Adicional</h2>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label for="{{ form.history.id_for_label }}" class="form-label">Historia</label>
                            {{ form.history|add_class:"form-control" }}
                        </div>

                        <div class="form-row form-row-2">
                            <div class="form-group">
                                <label for="{{ form.slogan.id_for_label }}" class="form-label">Slogan</label>
                                {{ form.slogan|add_class:"form-control" }}
                            </div>
                            <div class="form-group">
                                <label for="{{ form.founded_date.id_for_label }}" class="form-label">Fecha de Fundación</label>
                                {{ form.founded_date|add_class:"form-control" }}
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Imagen de la Empresa</label>
                            <div class="file-upload-area">
                                <div class="file-upload-content">
                                    {% if company.image %}
                                        <img src="{{ company.image.url }}" alt="Imagen" class="mb-2" style="max-height: 150px;">
                                    {% else %}
                                        <svg class="file-upload-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
                                    {% endif %}
                                    <p class="file-upload-text">Arrastra y suelta un archivo o</p>
                                    <button type="button" class="file-upload-button">Seleccionar archivo</button>
                                </div>
                            </div>
                            {{ form.image|add_class:"file-input" }}
                        </div>
                    </div>
                </div>

                <!-- Información Legal y Financiera -->
                <div class="card">
                    <div class="card-header card-header-amber">
                        <h2 class="card-title card-title-amber">Información Legal y Financiera</h2>
                    </div>
                    <div class="card-body">
                        <div class="form-row form-row-2">
                            <div class="form-group">
                                <label for="{{ form.legal_representative.id_for_label }}" class="form-label">Representante Legal</label>
                                {{ form.legal_representative|add_class:"form-control" }}
                            </div>
                            <div class="form-group">
                                <label for="{{ form.capital.id_for_label }}" class="form-label">Capital</label>
                                {{ form.capital|add_class:"form-control" }}
                            </div>
                        </div>

                        <div class="form-row form-row-2">
                            <div class="form-group">
                                <label for="{{ form.employees_count.id_for_label }}" class="form-label">Número de Empleados</label>
                                {{ form.employees_count|add_class:"form-control" }}
                            </div>
                            <div class="form-group">
                                <label for="{{ form.branches_count.id_for_label }}" class="form-label">Número de Sucursales</label>
                                {{ form.branches_count|add_class:"form-control" }}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Horario y Ubicación -->
                <div class="card">
                    <div class="card-header card-header-teal">
                        <h2 class="card-title card-title-teal">Horario y Ubicación</h2>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label for="{{ form.opening_hours.id_for_label }}" class="form-label">Horario de Atención</label>
                            {{ form.opening_hours|add_class:"form-control" }}
                        </div>

                        <div class="form-row form-row-2">
                            <div class="form-group">
                                <label for="{{ form.latitude.id_for_label }}" class="form-label">Latitud</label>
                                {{ form.latitude|add_class:"form-control" }}
                            </div>
                            <div class="form-group">
                                <label for="{{ form.longitude.id_for_label }}" class="form-label">Longitud</label>
                                {{ form.longitude|add_class:"form-control" }}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Información Comercial -->
                <div class="card">
                    <div class="card-header card-header-rose">
                        <h2 class="card-title card-title-rose">Información Comercial</h2>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label for="{{ form.industry.id_for_label }}" class="form-label">Industria</label>
                            {{ form.industry|add_class:"form-control" }}
                        </div>

                        <div class="form-group">
                            <label for="{{ form.services.id_for_label }}" class="form-label">Servicios</label>
                            {{ form.services|add_class:"form-control" }}
                        </div>
                    </div>
                </div>

                <div class="text-right mt-4">
                    <button type="submit" name="save_company" class="btn btn-primary btn-lg btn-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
                        Guardar Cambios
                    </button>
                </div>
            </form>
        </div>
 <!-- Columna Lateral -->
 <div class="space-y-6">
    <!-- Certificaciones -->
    <div class="card">
        <div class="card-header card-header-indigo">
            <h2 class="card-title card-title-indigo flex justify-between items-center">
                <span class="flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><circle cx="12" cy="8" r="7"></circle><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline></svg>
                    Certificaciones
                </span>
                <button type="button" class="btn btn-indigo btn-sm btn-icon" data-bs-toggle="modal" data-bs-target="#addCertificationModal">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                    Agregar
                </button>
            </h2>
        </div>
       
        <div class="card-body">
          
            {% if certifications %}
                <div class="space-y-3">
                    {% for cert in certifications %}
                        <div class="list-item">
                            <div class="list-item-content">
                                <div class="list-item-icon">
                                    {% if cert.logos %}
                                        <img src="{{ cert.logos.url }}" alt="{{ cert.name_certification }}" style="width: 24px; height: 24px;">
                                    {% else %}
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="7"></circle><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline></svg>
                                    {% endif %}
                                </div>
                                <div class="list-item-text">
                                    <h3>{{ cert.name_certification }}</h3>
                                </div>
                            </div>
                            <div class="list-item-actions">
                                <button type="button" class="action-button" data-bs-toggle="modal" data-bs-target="#editCertificationModal{{ cert.id }}">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                                </button>
                                <button type="button" class="action-button delete" data-bs-toggle="modal" data-bs-target="#deleteCertificationModal{{ cert.id }}">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                                </button>
                            </div>
                        </div>

                        
                        <div class="modal fade" id="editCertificationModal{{ cert.id }}" tabindex="-1">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title">Editar Certificación</h5>
                                        <button type="button" class="modal-close" data-bs-dismiss="modal">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                                        </button>
                                    </div>
                                    <form method="POST" enctype="multipart/form-data">
                                        {% csrf_token %}
                                        <div class="modal-body">
                                            <div class="form-group">
                                                <label class="form-label">Nombre de la certificación</label>
                                                <input type="text" class="form-control" name="name_certification" 
                                                       value="{{ cert.name_certification }}">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Logo</label>
                                                {% if cert.logos %}
                                                    <img src="{{ cert.logos.url }}" alt="Logo actual" 
                                                         class="mb-2 d-block" style="max-height: 100px;">
                                                {% endif %}
                                                <div class="file-upload-area">
                                                    <div class="file-upload-content">
                                                        <p class="file-upload-text">Arrastra y suelta un archivo o</p>
                                                        <button type="button" class="file-upload-button">Seleccionar archivo</button>
                                                    </div>
                                                </div>
                                                <input type="file" class="file-input" name="logos">
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                            <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        
                        <div class="modal fade" id="deleteCertificationModal{{ cert.id }}" tabindex="-1">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title">Confirmar Eliminación</h5>
                                        <button type="button" class="modal-close" data-bs-dismiss="modal">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        <p>¿Está seguro que desea eliminar la certificación <strong>{{ cert.name_certification }}</strong>?</p>
                                        <p class="text-danger">Esta acción no se puede deshacer.</p>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                        <form action="{% url 'admin_delete_certification' cert.id %}" method="POST">
                                            {% csrf_token %}
                                            <button type="submit" class="btn btn-danger">Eliminar</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="text-center text-muted">No hay certificaciones registradas.</p>
            {% endif %}
           
            <!-- Certificaciones No Asociadas -->
            {% if all_certifications %}
                <div class="space-y-3 mt-4">
                    <h4 class="font-medium text-gray-700">Certificaciones No Asociadas</h4>
                    {% for cert in all_certifications %}
                        <div class="list-item">
                            <div class="list-item-content">
                                <div class="list-item-icon">
                                    {% if cert.logos %}
                                        <img src="{{ cert.logos.url }}" alt="{{ cert.name_certification }}" style="width: 24px; height: 24px;">
                                    {% else %}
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="7"></circle><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline></svg>
                                    {% endif %}
                                </div>
                                <div class="list-item-text">
                                    <h5>{{ cert.name_certification }}</h5>
                                </div>
                            </div>
                            <div class="list-item-actions">
                                <form action="{% url 'admin_associate_certification' cert.id %}" method="POST" style="display: inline;">
                                    {% csrf_token %}
                                    <button type="submit" class="action-button">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M5 12h14"></path></svg>
                                    </button>
                                </form>
                                <button type="button" class="action-button" data-bs-toggle="modal" data-bs-target="#editCertificationModal{{ cert.id }}">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                                </button>
                                <button type="button" class="action-button delete" data-bs-toggle="modal" data-bs-target="#deleteCertificationModal{{ cert.id }}">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Modal de Edición -->
                        <div class="modal fade" id="editCertificationModal{{ cert.id }}" tabindex="-1">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title">Editar Certificación</h5>
                                        <button type="button" class="modal-close" data-bs-dismiss="modal">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                                        </button>
                                    </div>
                                    <form method="POST" enctype="multipart/form-data">
                                        {% csrf_token %}
                                        <div class="modal-body">
                                            <div class="form-group">
                                                <label class="form-label">Nombre de la certificación</label>
                                                <input type="text" class="form-control" name="name_certification" 
                                                       value="{{ cert.name_certification }}">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Logo</label>
                                                {% if cert.logos %}
                                                    <img src="{{ cert.logos.url }}" alt="Logo actual" 
                                                         class="mb-2 d-block" style="max-height: 100px;">
                                                {% endif %}
                                                <div class="file-upload-area">
                                                    <div class="file-upload-content">
                                                        <p class="file-upload-text">Arrastra y suelta un archivo o</p>
                                                        <button type="button" class="file-upload-button">Seleccionar archivo</button>
                                                    </div>
                                                </div>
                                                <input type="file" class="file-input" name="logos">
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                            <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- Modal de Eliminación -->
                        <div class="modal fade" id="deleteCertificationModal{{ cert.id }}" tabindex="-1">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title">Confirmar Eliminación</h5>
                                        <button type="button" class="modal-close" data-bs-dismiss="modal">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        <p>¿Está seguro que desea eliminar la certificación <strong>{{ cert.name_certification }}</strong>?</p>
                                        <p class="text-danger">Esta acción no se puede deshacer.</p>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                        <form action="{% url 'admin_delete_certification' cert.id %}" method="POST">
                                            {% csrf_token %}
                                            <button type="submit" class="btn btn-danger">Eliminar</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Empleados -->
    <div class="card">
        <div class="card-header card-header-emerald">
            <h2 class="card-title card-title-emerald flex justify-between items-center">
                <span class="flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                    Empleados
                </span>
                <button type="button" class="btn btn-emerald btn-sm btn-icon" data-bs-toggle="modal" data-bs-target="#addEmployeeModal">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                    Agregar
                </button>
            </h2>
        </div>
        <div class="card-body">
            {% if company.employees.all %}
                <div class="space-y-3">
                    {% for employee in company.employees.all %}
                        <div class="list-item">
                            <div class="list-item-content">
                                <div class="avatar">
                                    {% if employee.profile_picture %}
                                        <img src="{{ employee.profile_picture.url }}" alt="{{ employee.name }}" 
                                             class="rounded-full" style="width: 40px; height: 40px; object-fit: cover;">
                                    {% else %}
                                        <span class="avatar-text">{{ employee.name|make_list|first|upper }}</span>
                                    {% endif %}
                                </div>
                                <div class="list-item-text">
                                    <h3>{{ employee.name }}</h3>
                                    <p>{{ employee.position }}</p>
                                </div>
                            </div>
                            <div class="list-item-actions">
                                <button type="button" class="action-button" data-bs-toggle="modal" 
                                        data-bs-target="#editEmployeeModal{{ employee.id }}">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                                </button>
                                <button type="button" class="action-button delete" data-bs-toggle="modal" 
                                        data-bs-target="#deleteEmployeeModal{{ employee.id }}">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Modal para editar empleado - DENTRO del bucle for -->
                        <div class="modal fade" id="editEmployeeModal{{ employee.id }}" tabindex="-1" 
                             aria-labelledby="editEmployeeModalLabel{{ employee.id }}" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="editEmployeeModalLabel{{ employee.id }}">Editar Empleado</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <!-- Formulario para editar empleado -->
                                        <form action="{% url 'edit_employee' employee.id %}" method="POST" enctype="multipart/form-data">
                                            {% csrf_token %}
                                            <div class="mb-3">
                                                <label for="name{{ employee.id }}" class="form-label">Nombre del Empleado</label>
                                                <input type="text" class="form-control" id="name{{ employee.id }}" name="name" 
                                                       value="{{ employee.name }}" required>
                                            </div>
                                            <div class="mb-3">
                                                <label for="position{{ employee.id }}" class="form-label">Posición</label>
                                                <input type="text" class="form-control" id="position{{ employee.id }}" name="position" 
                                                       value="{{ employee.position }}" required>
                                            </div>
                                            <div class="mb-3">
                                                <label for="email{{ employee.id }}" class="form-label">Correo Electrónico</label>
                                                <input type="email" class="form-control" id="email{{ employee.id }}" name="email" 
                                                       value="{{ employee.email }}" required>
                                            </div>
                                            <div class="mb-3">
                                                <label for="phone{{ employee.id }}" class="form-label">Teléfono</label>
                                                <input type="text" class="form-control" id="phone{{ employee.id }}" name="phone" 
                                                       value="{{ employee.phone|default:'' }}">
                                            </div>
                                            <div class="mb-3">
                                                <label for="profile_picture{{ employee.id }}" class="form-label">Foto de Perfil</label>
                                                {% if employee.profile_picture %}
                                                    <div class="mb-2">
                                                        <img src="{{ employee.profile_picture.url }}" alt="{{ employee.name }}" 
                                                             class="img-thumbnail" style="max-height: 100px;">
                                                    </div>
                                                {% endif %}
                                                <input type="file" class="form-control" id="profile_picture{{ employee.id }}" name="profile_picture">
                                                <small class="form-text text-muted">Deje en blanco para mantener la imagen actual.</small>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                                <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Modal para confirmar eliminación de empleado - DENTRO del bucle for -->
                        <div class="modal fade" id="deleteEmployeeModal{{ employee.id }}" tabindex="-1" 
                             aria-labelledby="deleteEmployeeModalLabel{{ employee.id }}" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="deleteEmployeeModalLabel{{ employee.id }}">Confirmar Eliminación</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <p>¿Está seguro que desea eliminar al empleado <strong>{{ employee.name }}</strong>?</p>
                                        <p class="text-danger">Esta acción no se puede deshacer.</p>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                        <form action="{% url 'delete_employee' employee.id %}" method="POST">
                                            {% csrf_token %}
                                            <button type="submit" class="btn btn-danger">Eliminar</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="text-center text-muted">No hay empleados registrados.</p>
            {% endif %}
        </div>
    </div>
</div>
</div>
</div>

<!-- Modal para agregar empleado - FUERA del bucle for porque no depende de un empleado específico -->
<div class="modal fade" id="addEmployeeModal" tabindex="-1" aria-labelledby="addEmployeeModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addEmployeeModalLabel">Agregar Nuevo Empleado</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Formulario para agregar empleado -->
                <form action="{% url 'add_employee' %}" method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="name" class="form-label">Nombre del Empleado</label>
                        <input type="text" class="form-control" id="name" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label for="position" class="form-label">Posición</label>
                        <input type="text" class="form-control" id="position" name="position" required>
                    </div>
                    <div class="mb-3">
                        <label for="email" class="form-label">Correo Electrónico</label>
                        <input type="email" class="form-control" id="email" name="email" required>
                    </div>
                    <div class="mb-3">
                        <label for="phone" class="form-label">Teléfono</label>
                        <input type="text" class="form-control" id="phone" name="phone">
                    </div>
                    <div class="mb-3">
                        <label for="profile_picture" class="form-label">Foto de Perfil</label>
                        <input type="file" class="form-control" id="profile_picture" name="profile_picture">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Guardar Empleado</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal para Agregar Certificación -->
<div class="modal fade" id="addCertificationModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Agregar Certificación</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="modal-body">
                    {{ certification_form.as_p }}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" name="add_certification" class="btn btn-primary">Agregar</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
// JavaScript para manejar la carga de archivos
document.addEventListener('DOMContentLoaded', function() {
    // Para cada área de carga de archivos
    document.querySelectorAll('.file-upload-area').forEach(function(area) {
        const fileInput = area.nextElementSibling;
        const button = area.querySelector('.file-upload-button');
        
        // Cuando se hace clic en el botón, activar el input de archivo
        button.addEventListener('click', function() {
            fileInput.click();
        });
        
        // Cuando se arrastra un archivo sobre el área
        area.addEventListener('dragover', function(e) {
            e.preventDefault();
            area.classList.add('border-primary');
        });
        
        // Cuando se deja de arrastrar sobre el área
        area.addEventListener('dragleave', function() {
            area.classList.remove('border-primary');
        });
        
        // Cuando se suelta un archivo en el área
        area.addEventListener('drop', function(e) {
            e.preventDefault();
            area.classList.remove('border-primary');
            
            if (e.dataTransfer.files.length) {
                fileInput.files = e.dataTransfer.files;
                
                // Mostrar nombre del archivo
                const fileName = e.dataTransfer.files[0].name;
                const fileText = area.querySelector('.file-upload-text');
                fileText.textContent = fileName;
            }
        });
        
        // Cuando se selecciona un archivo mediante el diálogo
        fileInput.addEventListener('change', function() {
            if (fileInput.files.length) {
                const fileName = fileInput.files[0].name;
                const fileText = area.querySelector('.file-upload-text');
                fileText.textContent = fileName;
            }
        });
    });
    
    // Validación del formulario
    $('#companyForm').submit(function(e) {
        let isValid = true;
        
        // Solo verificar campos que son realmente obligatorios
        $('#id_name, #id_ruc, #id_address, #id_phone, #id_email').each(function() {
            if (!$(this).val()) {
                isValid = false;
                $(this).addClass('is-invalid');
            } else {
                $(this).removeClass('is-invalid');
            }
        });

        if (!isValid) {
            e.preventDefault();
            alert('Por favor, complete los campos obligatorios: Nombre, RUC, Dirección, Teléfono y Email.');
        }
    });
});
</script>
{% endblock %}
