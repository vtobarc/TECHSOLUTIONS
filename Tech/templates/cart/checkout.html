{% extends 'base.html' %}
{% load static %}

{% block title %}Finalizar Compra - TECHVANGUARD{% endblock %}


{% block extra_css %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Reset y estilos generales */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            color: #333;
            background-color: #f5f5f5;
            line-height: 1.6;
        }
        
        a {
            text-decoration: none;
            color: inherit;
        }
        
        /* Header y navegación */
        .header {
            background-color: #1b3027;
            color: white;
            padding: 15px 40px;
        }
        
        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .nav-links {
            display: flex;
            gap: 30px;
        }
        
        .nav-links a {
            color: white;
            text-decoration: none;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .logo {
            font-size: 28px;
            font-weight: 500;
            letter-spacing: 2px;
            text-align: center;
        }
        
        .cart-icon {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .cart-icon i {
            font-size: 18px;
        }
        
        /* Título de la página */
        .page-title {
            background-color: #0f2231;
            color: white;
            text-align: center;
            padding: 20px 0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* Contenedor principal */
        .container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
        }
        
        /* Grid layout */
        .checkout-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }
        
        @media (max-width: 992px) {
            .checkout-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Estilos del formulario */
        .checkout-form {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }
        
        .form-section {
            padding: 30px;
            border-bottom: 1px solid #eee;
        }
        
        .form-section:last-child {
            border-bottom: none;
        }
        
        .form-section h2 {
            font-size: 18px;
            margin-bottom: 20px;
            font-weight: 600;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 15px;
            transition: border-color 0.2s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #1b3027;
        }
        
        .form-control.error {
            border-color: #e53e3e;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }
        
        .form-check {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .form-check input {
            margin-right: 10px;
        }
        
        /* Métodos de pago */
        .payment-methods {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        @media (min-width: 768px) {
            .payment-methods {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        .payment-method {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .payment-method:hover {
            border-color: #1b3027;
            background-color: rgba(27, 48, 39, 0.05);
        }
        
        .payment-method.selected {
            border-color: #1b3027;
            background-color: rgba(27, 48, 39, 0.05);
        }
        
        .payment-method i {
            font-size: 24px;
            margin-bottom: 10px;
            color: #1b3027;
        }
        
        /* Detalles de pago */
        .payment-details {
            display: none;
            background-color: #f9f9f9;
            border-radius: 4px;
            padding: 20px;
            margin-top: 15px;
            margin-bottom: 20px;
        }
        
        .payment-details.active {
            display: block;
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .payment-details p {
            margin-bottom: 8px;
        }
        
        .payment-details .store-locations {
            margin-top: 15px;
        }
        
        .payment-details .store-location {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .payment-details .store-location:last-child {
            border-bottom: none;
        }
        
        .payment-details .card-form {
            opacity: 0.7;
            pointer-events: none;
        }
        
        .payment-details .card-form .form-control {
            background-color: #f0f0f0;
        }
        
        /* Resumen del pedido */
        .order-summary {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 30px;
            position: sticky;
            top: 20px;
        }
        
        .order-summary h2 {
            font-size: 18px;
            margin-bottom: 20px;
            font-weight: 600;
            text-align: center;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .order-items {
            margin-bottom: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .order-item {
            display: flex;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .order-item:last-child {
            border-bottom: none;
        }
        
        .order-item-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 4px;
            margin-right: 15px;
        }
        
        .order-item-details {
            flex: 1;
        }
        
        .order-item-name {
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .order-item-meta {
            display: flex;
            justify-content: space-between;
            color: #666;
            font-size: 14px;
        }
        
        /* Opciones de envío */
        .shipping-options {
            margin: 20px 0;
        }
        
        .shipping-option {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .shipping-option input {
            margin-right: 10px;
        }
        
        .shipping-option label {
            font-size: 14px;
        }
        
        /* Totales */
        .order-summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .order-summary-row.total {
            font-size: 18px;
            font-weight: 600;
            padding-top: 15px;
            margin-top: 15px;
            border-top: 1px solid #eee;
        }
        
        .tax-note {
            text-align: right;
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        /* Botón de realizar pedido */
        .place-order-btn {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: #1b3027;
            color: white;
            text-align: center;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            margin-top: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: background-color 0.2s;
        }
        
        .place-order-btn:hover {
            background-color: #2a4a3e;
        }
        
        .back-to-cart {
            display: block;
            text-align: center;
            margin-top: 15px;
            color: #1b3027;
            font-size: 14px;
        }
        
        .back-to-cart:hover {
            text-decoration: underline;
        }
        
        /* Cupón */
        .coupon-section {
            margin-bottom: 20px;
        }
        
        .coupon-toggle {
            color: #1b3027;
            font-size: 14px;
            cursor: pointer;
        }
        
        .coupon-toggle:hover {
            text-decoration: underline;
        }
        
        .coupon-form {
            display: none;
            margin-top: 15px;
        }
        
        .coupon-form.active {
            display: flex;
        }
        
        .coupon-input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 4px 0 0 4px;
            font-size: 14px;
        }
        
        .coupon-btn {
            padding: 10px 15px;
            background-color: #1b3027;
            color: white;
            border: none;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
            font-size: 14px;
        }
        
        /* Modal de éxito */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            padding: 30px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            transform: translateY(20px);
            transition: transform 0.3s;
        }
        
        .modal-overlay.active .modal-content {
            transform: translateY(0);
        }
        
        .success-icon {
            width: 80px;
            height: 80px;
            background-color: #ebf7ee;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            position: relative;
        }
        
        .success-icon svg {
            width: 40px;
            height: 40px;
            color: #28a745;
        }
        
        /* Animación del checkmark */
        .checkmark {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: block;
            stroke-width: 3;
            stroke: #28a745;
            stroke-miterlimit: 10;
            box-shadow: inset 0px 0px 0px #28a745;
            animation: fill .4s ease-in-out .4s forwards, scale .3s ease-in-out .9s both;
        }
        
        .checkmark__circle {
            stroke-dasharray: 166;
            stroke-dashoffset: 166;
            stroke-width: 3;
            stroke-miterlimit: 10;
            stroke: #28a745;
            fill: none;
            animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
        }
        
        .checkmark__check {
            transform-origin: 50% 50%;
            stroke-dasharray: 48;
            stroke-dashoffset: 48;
            animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
        }
        
        @keyframes stroke {
            100% {
                stroke-dashoffset: 0;
            }
        }
        
        @keyframes scale {
            0%, 100% {
                transform: none;
            }
            50% {
                transform: scale3d(1.1, 1.1, 1);
            }
        }
        
        @keyframes fill {
            100% {
                box-shadow: inset 0px 0px 0px 30px #ebf7ee;
            }
        }
        
        .modal-title {
            font-size: 24px;
            margin-bottom: 15px;
        }
        
        .order-number {
            font-weight: 600;
        }
        
        .modal-message {
            color: #666;
            margin-bottom: 25px;
        }
        
        .order-details {
            text-align: left;
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        
        .order-details p {
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .order-details strong {
            font-weight: 600;
        }
        
        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        @media (max-width: 576px) {
            .modal-buttons {
                flex-direction: column;
            }
        }
        
        .btn {
            padding: 12px 20px;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            font-size: 14px;
        }
        
        .btn-primary {
            background-color: #1b3027;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2a4a3e;
        }
        
        .btn-secondary {
            background-color: #eee;
            color: #333;
        }
        
        .btn-secondary:hover {
            background-color: #ddd;
        }
        
    
        /* Spinner de carga */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
            vertical-align: middle;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .place-order-btn.loading {
            pointer-events: none;
            opacity: 0.8;
        }
    </style>
{% endblock %}




{% block content %}
 <div class="page-title">
        <h1>Finalizar Compra</h1>
    </div>

    <div class="container">
        <div class="checkout-grid">
            <!-- Formulario de Checkout -->
            <div class="checkout-form">
                <!-- Información de Contacto -->
                <div class="form-section">
                    <h2>Información de Contacto</h2>
                    <div class="form-group">
                        <label for="email">Correo Electrónico</label>
                        <input type="email" id="email" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="phone">Teléfono</label>
                        <input type="tel" id="phone" class="form-control" required>
                    </div>
                </div>

                <!-- Dirección de Envío -->
                <div class="form-section">
                    <h2>Dirección de Envío</h2>
                    <div class="form-group">
                        <label for="fullname">Nombre Completo</label>
                        <input type="text" id="fullname" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="address">Dirección</label>
                        <input type="text" id="address" class="form-control" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="city">Ciudad</label>
                            <input type="text" id="city" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="postal">Código Postal</label>
                            <input type="text" id="postal" class="form-control" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="state">Estado</label>
                        <input type="text" id="state" class="form-control" required>
                    </div>
                </div>

                <!-- Método de Pago -->
                <div class="form-section">
                    <div class="payment-header" id="paymentHeader">
                        <h2>Método de Pago</h2>
                        <button class="payment-toggle" id="paymentToggle">
                            <i class="fas fa-chevron-down" id="toggleIcon"></i>
                            <span id="toggleText">Abrir</span>
                        </button>
                    </div>
                    
                    <div class="payment-content" id="paymentContent">
                        <div class="payment-methods">
                            <div class="payment-method" data-method="credit">
                                <i class="fas fa-credit-card"></i>
                                <span>Tarjeta de Crédito</span>
                            </div>
                            <div class="payment-method" data-method="debit">
                                <i class="fas fa-credit-card"></i>
                                <span>Tarjeta de Débito</span>
                            </div>
                            <div class="payment-method" data-method="transfer">
                                <i class="fas fa-university"></i>
                                <span>Transferencia</span>
                            </div>
                            <div class="payment-method" data-method="store">
                                <i class="fas fa-store"></i>
                                <span>Tiendas Físicas</span>
                            </div>
                        </div>

                        <!-- Detalles de pago - Transferencia Bancaria -->
                        <div id="transfer-details" class="payment-details">
                            <p>Haz tu pago directamente en nuestra cuenta bancaria:</p>
                            <p class="font-medium mt-2">TECHVANGUARD SAS</p>
                            <p>Banco Guayaquil</p>
                            <p>Cuenta corriente: 001914310</p>
                            <p>RUC: 0993360473001</p>
                            <p class="mt-4 text-sm">Una vez realizado el depósito o transferencia comuníquese al correo: servicioalcliente@techvanguard.com.ec</p>
                        </div>
                        
                        <!-- Detalles de pago - Tarjetas -->
                        <div id="card-details" class="payment-details">
                            <div class="card-form">
                                <div class="form-group">
                                    <label for="card-number">Número de tarjeta</label>
                                    <input type="text" id="card-number" placeholder="1234 5678 9012 3456" class="form-control" disabled>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="card-expiry">Fecha de expiración</label>
                                        <input type="text" id="card-expiry" placeholder="MM/AA" class="form-control" disabled>
                                    </div>
                                    <div class="form-group">
                                        <label for="card-cvc">CVC</label>
                                        <input type="text" id="card-cvc" placeholder="123" class="form-control" disabled>
                                    </div>
                                </div>
                            </div>
                            <p class="mt-4 text-red-500 text-sm">* Pago con tarjeta temporalmente deshabilitado. Por favor, seleccione otro método de pago.</p>
                        </div>
                        
                        <!-- Detalles de pago - Tiendas Físicas -->
                        <div id="store-details" class="payment-details">
                            <p>Puede realizar su pago en cualquiera de nuestras tiendas físicas:</p>
                            <div class="store-locations">
                                <div class="store-location">
                                    <p class="font-medium">TECHVANGUARD Samborondón</p>
                                    <p class="text-sm">Plaza Lagos Town Center, Local 12</p>
                                    <p class="text-sm">Horario: Lunes a Sábado 10:00 - 20:00, Domingo 11:00 - 19:00</p>
                                </div>
                                <div class="store-location">
                                    <p class="font-medium">TECHVANGUARD Guayaquil</p>
                                    <p class="text-sm">Mall del Sol, Planta Baja, Local 42</p>
                                    <p class="text-sm">Horario: Lunes a Domingo 10:00 - 21:00</p>
                                </div>
                                <div class="store-location">
                                    <p class="font-medium">TECHVANGUARD Quito</p>
                                    <p class="text-sm">Quicentro Shopping, Segundo Piso, Local 215</p>
                                    <p class="text-sm">Horario: Lunes a Domingo 10:00 - 20:00</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-check" style="margin-top: 20px;">
                        <input type="checkbox" id="terms">
                        <label for="terms">
                            He leído y estoy de acuerdo con los <a href="#" style="color: #1b3027; text-decoration: underline;">Términos y condiciones</a> de la web.
                        </label>
                    </div>
                </div>
            </div>

            <!-- Resumen del Pedido -->
            <div class="order-summary">
                <h2>Resumen del Pedido</h2>
                
                <div class="order-items" id="orderItems">
                    <!-- Los items se cargarán dinámicamente con JavaScript -->
                    <div class="order-item">
                        <img src="https://placehold.co/100x100" alt="Smartphone XYZ" class="order-item-image">
                        <div class="order-item-details">
                            <div class="order-item-name">Smartphone XYZ</div>
                            <div class="order-item-meta">
                                <span>1 x $299.99</span>
                                <span>$299.99</span>
                            </div>
                        </div>
                    </div>
                    <div class="order-item">
                        <img src="https://placehold.co/100x100" alt="Wireless Earbuds" class="order-item-image">
                        <div class="order-item-details">
                            <div class="order-item-name">Wireless Earbuds</div>
                            <div class="order-item-meta">
                                <span>2 x $89.99</span>
                                <span>$179.98</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="order-summary-row">
                    <span>Subtotal</span>
                    <span id="orderSubtotal">$479.97</span>
                </div>

                <!-- Opciones de envío -->
                <div class="shipping-options">
                    <h3 style="font-size: 14px; margin-bottom: 10px;">Envío</h3>
                    <div class="shipping-option">
                        <input type="radio" id="shipping-1" name="shipping" value="4.00" checked>
                        <label for="shipping-1">Samborondón (hasta km. 8) y Durán: $4.00</label>
                    </div>
                    <div class="shipping-option">
                        <input type="radio" id="shipping-2" name="shipping" value="5.00">
                        <label for="shipping-2">La Aurora y Mocolí: $5.00</label>
                    </div>
                    <div class="shipping-option">
                        <input type="radio" id="shipping-3" name="shipping" value="5.00">
                        <label for="shipping-3">Urdesa y Alborada: $5.00</label>
                    </div>
                    <div class="shipping-option">
                        <input type="radio" id="shipping-4" name="shipping" value="5.50">
                        <label for="shipping-4">Los Ceibos y Vía a Daule: $5.50</label>
                    </div>
                    <div class="shipping-option">
                        <input type="radio" id="shipping-5" name="shipping" value="6.00">
                        <label for="shipping-5">Vía a La Costa: $6.00</label>
                    </div>
                    <div class="shipping-option">
                        <input type="radio" id="shipping-6" name="shipping" value="8.00">
                        <label for="shipping-6">Envíos Nacionales (Servientrega): $8.00</label>
                    </div>
                </div>

                <div class="order-summary-row">
                    <span>Envío</span>
                    <span id="orderShipping">$4.00</span>
                </div>
                <div class="order-summary-row">
                    <span>IVA (15%)</span>
                    <span id="orderTax">$72.00</span>
                </div>
                <div class="order-summary-row total">
                    <span>Total</span>
                    <span id="orderTotal">$555.97</span>
                </div>
                <div class="tax-note">
                    (Incluye <span id="tax-note">$72.00</span> de IVA)
                </div>
                
                <button id="placeOrderBtn" class="place-order-btn">
                    Realizar Pedido
                </button>
                
                <a href="#" class="back-to-cart">
                    Volver al carrito
                </a>
            </div>
        </div>
    </div>

    <!-- Mensaje de Éxito (oculto por defecto) -->
    <div id="orderSuccess" class="modal-overlay">
        <div class="modal-content">
            <div class="success-icon">
                <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                    <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
                    <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
                </svg>
            </div>
            <h2 class="modal-title">¡Pedido Realizado con Éxito!</h2>
            <p class="modal-message">Tu número de pedido es: <span class="order-number" id="orderNumber">VIS-12345</span></p>
            <p class="modal-message">Hemos enviado un correo electrónico con los detalles de tu compra.</p>
            <div class="modal-buttons">
                <button class="btn btn-primary" id="continueShopping">Continuar Comprando</button>
                <button class="btn btn-secondary" id="closeSuccessBtn">Cerrar</button>
            </div>
        </div>
    </div>

<script>
    
    document.addEventListener('DOMContentLoaded', function() {
        // Cargar el resumen del pedido
        loadOrderSummary();
    
        // Seleccionar método de pago
        const paymentMethods = document.querySelectorAll('.payment-method');
        paymentMethods.forEach(method => {
            method.addEventListener('click', function() {
                // Quitar selección anterior
                paymentMethods.forEach(m => m.classList.remove('border-blue-500', 'bg-blue-50'));
                // Añadir selección actual
                this.classList.add('border-blue-500', 'bg-blue-50');
                
                // Ocultar todos los detalles de pago
                document.querySelectorAll('.payment-details').forEach(detail => {
                    detail.classList.add('hidden');
                });
                
                // Mostrar detalles según el método seleccionado
                const selectedMethod = this.getAttribute('data-method');
                if (selectedMethod === 'transfer') {
                    document.getElementById('transfer-details').classList.remove('hidden');
                } else if (selectedMethod === 'credit' || selectedMethod === 'debit') {
                    document.getElementById('card-details').classList.remove('hidden');
                } else if (selectedMethod === 'store') {
                    document.getElementById('store-details').classList.remove('hidden');
                }
            });
        });
    
        // Opciones de envío
        const shippingOptions = document.querySelectorAll('input[name="shipping"]');
        shippingOptions.forEach(option => {
            option.addEventListener('change', function() {
                updateTotals();
            });
        });
    
        // Botón de realizar pedido
        const placeOrderBtn = document.getElementById('placeOrderBtn');
        placeOrderBtn.addEventListener('click', placeOrder);
    
        // Botón de cerrar mensaje de éxito
        const closeSuccessBtn = document.getElementById('closeSuccessBtn');
        closeSuccessBtn.addEventListener('click', function() {
            document.getElementById('orderSuccess').classList.add('hidden');
        });
        
        // Actualizar envío cuando cambia la ciudad
        document.getElementById('city').addEventListener('change', function() {
            const city = this.value.trim().toLowerCase();
            
            // Seleccionar opción de envío según la ciudad
            if (city === 'samborondón' || city === 'samborondon') {
                document.getElementById('shipping-1').checked = true;
            } else if (city === 'guayaquil') {
                document.getElementById('shipping-2').checked = true;
            } else if (city === 'la aurora' || city === 'mocolí' || city === 'mocoli') {
                document.getElementById('shipping-3').checked = true;
            } else {
                document.getElementById('shipping-4').checked = true;
            }
            
            updateTotals();
        });
    });
    
    function loadOrderSummary() {
        // Obtener datos del carrito desde la sesión de Django
        fetch('{% url "cart_data" %}')
            .then(response => response.json())
            .then(data => {
                const orderItems = document.getElementById('orderItems');
                orderItems.innerHTML = '';
    
                let subtotal = 0;
    
                // Mostrar cada item del carrito
                data.cart_items.forEach(item => {
                    const itemTotal = item.price * item.quantity;
                    subtotal += itemTotal;
    
                    const itemElement = document.createElement('div');
                    itemElement.className = 'flex items-center pb-4 border-b border-gray-200';
                    itemElement.innerHTML = `
                        <div class="w-16 h-16 flex-shrink-0 mr-4">
                            <img src="${item.main_image || 'https://placehold.co/100x100'}" alt="${item.name}" class="w-full h-full object-cover rounded-md">
                        </div>
                        <div class="flex-1">
                            <h3 class="font-medium text-sm">${item.name}</h3>
                            <div class="flex justify-between mt-1">
                                <span class="text-gray-500 text-xs">${item.quantity} x $${item.price.toFixed(2)}</span>
                                <span class="font-medium text-sm">$${(item.price * item.quantity).toFixed(2)}</span>
                            </div>
                        </div>
                    `;
                    orderItems.appendChild(itemElement);
                });
    
                // Guardar el subtotal como variable global para usarlo en updateTotals
                window.cartSubtotal = subtotal;
                
                // Actualizar totales
                updateTotals();
            })
            .catch(error => {
                console.error('Error al cargar el resumen del pedido:', error);
                // Datos de ejemplo en caso de error
                window.cartSubtotal = 45.50;
                updateTotals();
            });
    }
    
    function updateTotals() {
        const subtotal = window.cartSubtotal || 0;
        
        // Obtener el costo de envío seleccionado
        const selectedShipping = document.querySelector('input[name="shipping"]:checked');
        const shipping = selectedShipping ? parseFloat(selectedShipping.value) : 4.00;
        
        const tax = subtotal * 0.15; // 15% de IVA
        const total = subtotal + shipping + tax;
        
        // Actualizar los totales en el DOM
        document.getElementById('orderSubtotal').textContent = `$${subtotal.toFixed(2)}`;
        document.getElementById('orderShipping').textContent = `$${shipping.toFixed(2)}`;
        document.getElementById('orderTax').textContent = `$${tax.toFixed(2)}`;
        document.getElementById('tax-note').textContent = `$${tax.toFixed(2)}`;
        document.getElementById('orderTotal').textContent = `$${total.toFixed(2)}`;
    }
    
    function placeOrder() {
        // Validar formulario
        const requiredFields = ['email', 'phone', 'fullname', 'address', 'city', 'postal', 'state'];
        let isValid = true;
    
        requiredFields.forEach(field => {
            const input = document.getElementById(field);
            if (!input.value.trim()) {
                input.classList.add('border-red-500');
                isValid = false;
            } else {
                input.classList.remove('border-red-500');
            }
        });
    
        // Verificar si se seleccionó un método de pago
        const selectedPayment = document.querySelector('.payment-method.border-blue-500');
        if (!selectedPayment) {
            alert('Por favor selecciona un método de pago');
            return;
        }
        
        // Verificar términos y condiciones
        const termsAccepted = document.getElementById('terms').checked;
        if (!termsAccepted) {
            alert('Debes aceptar los términos y condiciones para continuar');
            return;
        }
    
        if (!isValid) {
            alert('Por favor completa todos los campos requeridos');
            return;
        }
    
        // Generar número de pedido aleatorio
        const orderNumber = 'TECH-' + Math.floor(100000 + Math.random() * 900000);
        document.getElementById('orderNumber').textContent = orderNumber;
    
        // Mostrar mensaje de éxito
        document.getElementById('orderSuccess').classList.remove('hidden');
    
        // Obtener el costo de envío seleccionado
        const selectedShipping = document.querySelector('input[name="shipping"]:checked');
        const shipping = selectedShipping ? parseFloat(selectedShipping.value) : 4.00;
    
        // Aquí se enviaría el pedido al servidor
         fetch('{% url "process_order" %}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: JSON.stringify({
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                fullname: document.getElementById('fullname').value,
                address: document.getElementById('address').value,
                city: document.getElementById('city').value,
                postal: document.getElementById('postal').value,
                state: document.getElementById('state').value,
                payment_method: selectedPayment.dataset.method,
                shipping_cost: shipping,
                order_number: orderNumber
            })
         })
         
        .then(response => response.json())
       .then(data => {
            // Limpiar carrito después de procesar el pedido
           window.location.href = '{% url "order_success" %}';
         })
         .catch(error => {
            console.error('Error al procesar el pedido:', error);
         });
    }
    
    // Función para obtener el valor de una cookie
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    
</script>
{% endblock %}

